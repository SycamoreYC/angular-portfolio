

# ç¬¬äº”ç«  åˆ›å»ºé«˜çº§è¡¨å•

## 5.1 Angular JSè¡¨å•ä¸ä¼ ç»Ÿè¡¨å•çš„æ¯”è¾ƒ

### ä»‹ç»ngModelæŒ‡ä»¤

## 5.2 åˆ›å»ºç”¨æˆ·ä¿¡æ¯è¡¨å•

## 5.3 ç†è§£è¾“å…¥æŒ‡ä»¤

### æ·»åŠ æ‰€éœ€éªŒè¯

> æ‰€æœ‰åŸºæœ¬è¾“å…¥éªŒè¯éƒ½æ”¯æŒ`require`æˆ–`ng-required`å±æ€§ã€‚ä¸ºè¾“å…¥å…ƒç´ æ·»åŠ è¿™ä¸€å±æ€§å°±å¯ä»¥æ ¡éªŒã€‚

### ä½¿ç”¨åŸºäºæ–‡æœ¬çš„è¾“å…¥

### ä½¿ç”¨checkboxè¾“å…¥

### ä½¿ç”¨radioè¾“å…¥

### ä½¿ç”¨Selectè¾“å…¥

#### æä¾›ç®€å•çš„å­—ç¬¦ä¸²

#### åˆ©ç”¨ngOptionsæŒ‡ä»¤æä¾›åŠ¨æ€options

##### 1. ngOptionsçš„å…¸å‹ç¤ºä¾‹

###### ä½¿ç”¨æ•°ç»„æ•°æ®æº

###### ä½¿ç”¨å¯¹è±¡æ•°æ®æº

##### 2. ç†è§£dataSourceè¡¨è¾¾å¼

##### 3. ç†è§£optionBindingè¡¨è¾¾å¼

> `optionBinding`è¡¨è¾¾å¼å®šä¹‰äº†å¦‚ä½•è·å–æ¯ä¸ªoptionçš„labelå’Œå€¼ï¼Œä»¥åŠå¦‚ä½•å°†ç”±`dataSource`è¡¨è¾¾å¼æä¾›çš„æ¡ç›®ç”Ÿæˆçš„optionsåˆ†ç»„ã€‚

#### selectæŒ‡ä»¤ä¸ç©ºçš„options

#### ç†è§£selectå’Œå¯¹è±¡åˆ¤ç­‰

#### é€‰æ‹©å¤šä¸ªoptions

> ä¸ºselectæŒ‡ä»¤åº”ç”¨`multiple`å±æ€§å³å¯ã€‚

è¿™ä¸ªå¤šé€‰å®éªŒä¸‹æ¥æ•ˆæœä¸æ˜¯å¾ˆå¥½ã€‚ä¼šæŠŠæ‰€æœ‰é€‰é¡¹å±•ç¤ºå‡ºæ¥ï¼Œå¹¶ä¸”åœ¨æŒ‰æœ‰commandçš„æƒ…å†µä¸‹æ‰èƒ½å®ç°å¤šé€‰ã€‚

### è¿ç”¨ä¼ ç»Ÿçš„ HTML hidden input å­—æ®µ

ä¸€èˆ¬åœ¨ä¸¤ç§æƒ…å†µä¸‹éœ€è¦hidden inputå­—æ®µï¼šåµŒå…¥æ¥è‡ªæœåŠ¡å™¨çš„å€¼ï¼Œæäº¤ä¼ ç»Ÿçš„HTMLè¡¨å•ã€‚

#### åµŒå…¥æ¥è‡ªæœåŠ¡å™¨çš„å€¼

#### æäº¤ä¼ ç»Ÿçš„HTMLè¡¨å•

> ä¼ ç»Ÿä¸Šï¼Œä¹Ÿè®¸éœ€è¦å‘æœåŠ¡å™¨æäº¤ä¸åœ¨æ¨¡æ¿ä¸Šçš„å€¼ï¼Œä¹Ÿå°±æ˜¯éå¯è§çš„è¾“å…¥ç»„ä»¶ï¼Œè¿™é€šå¸¸é€šè¿‡ä¸ºè¡¨å•å¢åŠ hiddenå­—æ®µæ¥è§£å†³ã€‚Angular Jsä¸­ï¼Œå·¥ä½œçš„æ¨¡å‹å’Œè¡¨å•æ˜¯è§£è€¦çš„ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦è¿™äº›hiddenå­—æ®µã€‚åªéœ€è¦å•çº¯åœ°å°†è¿™äº›å€¼æ·»åŠ åˆ°ä½œç”¨åŸŸä¸Šï¼Œç„¶åä½¿ç”¨$httpæœåŠ¡æ¨¡æ‹Ÿè¡¨å•æäº¤å°±å¯ä»¥äº†ã€‚

ä¼¼ä¹æ˜¯åœ¨è¯´å¦‚æœæœ‰æ•°æ®è¦æäº¤åˆ°æœåŠ¡å™¨ä¸Šï¼Œç”¨$httpæœåŠ¡å°±OKäº†ã€‚

## 5.4 è¯¦è§£ngModelæ•°æ®ç»‘å®š

æ·±å…¥æŸ¥çœ‹ngModelæŒ‡ä»¤æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚

### ç†è§£ngModelController

> æ¯ä¸ªngModelæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºngModelControllerçš„ä¸€ä¸ªå®ä¾‹ï¼Œè¯¥æ§åˆ¶å™¨å¯¹inputå…ƒç´ ä¸Šçš„æ‰€æœ‰æŒ‡ä»¤éƒ½æœ‰æ•ˆã€‚
>
> ngModelControllerè´Ÿè´£ç®¡ç†å­˜å‚¨åœ¨æ¨¡å‹ä¸­çš„å€¼ä¸inputå…ƒç´ æ˜¾ç¤ºå€¼ä¹‹å‰çš„æ•°æ®ç»‘å®šã€‚
>
> ngModelControllerä¹Ÿè¿½è¸ªè§†å›¾ä¸Šçš„å€¼æ˜¯å¦æœ‰æ•ˆï¼Œä»¥åŠå®ƒæ˜¯å¦å·²ç»è¢«inputå…ƒç´ ä¿®æ”¹ã€‚

#### åœ¨æ¨¡å‹ä¸è§†å›¾ä¹‹é—´çš„è½¬æ¢å€¼

> å½“æ¯æ¬¡æ›´æ–°æ•°æ®ç»‘å®šçš„æ—¶å€™ï¼ŒngModelControlleréƒ½ä¼šåº”ç”¨å®ƒçš„è½¬æ¢ç®¡é“ã€‚æ­¤ç®¡é“ç”±ä¸¤ä¸ªæ•°ç»„ç»„æˆï¼š$formatterså¤„ç†ä»æ¨¡å‹é“è§†å›¾çš„è½¬æ¢ï¼Œ$parsersåˆ™å¤„ç†ä»è§†å›¾åˆ°æ¨¡å‹çš„è½¬æ¢ã€‚inputå…ƒç´ ä¸Šçš„æ¯ä¸ªæŒ‡ä»¤éƒ½å¯ä»¥æ·»åŠ å®ƒä»¬è‡ªå·±çš„formatterså’Œparsersåˆ°æ­¤ç®¡é“ï¼Œä»¥åˆ¶å®šæ•°æ®ç»‘å®šçš„è¡Œä¸ºã€‚

#### è¿½è¸ªå€¼æ˜¯å¦å˜åŒ–

> ä¼´éšæ¨¡å‹ä¸è§†å›¾ä¹‹é—´å€¼çš„è½¬æ¢ï¼ŒngModelControllerè¿½è¸ªåœ¨åˆå§‹åŒ–ä¹‹åçš„å€¼æ˜¯å¦æœ‰å˜åŒ–åŠæ˜¯å¦æœ‰æ•ˆã€‚
>
> å½“é¦–æ¬¡åˆå§‹åŒ–æ—¶ï¼ŒngModelControlleræ ‡è®°å€¼ä¸ºçº¯å‡€çš„ï¼Œä¹Ÿå°±æ˜¯è¿˜æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚

#### è·Ÿè¸ªinputå­—æ®µæœ‰æ•ˆæ€§

> input å…ƒç´ ä¸Šçš„æŒ‡ä»¤ä¹Ÿèƒ½å°†å€¼çš„validæˆ–invalidçŠ¶æ€é€šçŸ¥ç»™ngModelControllerï¼Œè¿™é€šå¸¸é€šè¿‡åŠ å…¥è½¬æ¢ç®¡é“çš„æŒ‚é’©æ¥å®Œæˆï¼Œå®ƒæ˜¯æ£€éªŒå€¼è€Œä¸æ˜¯è½¬æ¢ã€‚ngModelControllerè·Ÿè¸ªå€¼æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶ç›¸åº”åœ°åœ¨å…¶ä¸Šåº”ç”¨ng-validå’Œng-invalid CSSç±»ã€‚åŸºäºè¿™äº›ç±»ï¼Œå¯ä»¥æä¾›æ›´è¿›ä¸€æ­¥çš„æ ·å¼æ¥æ”¹å˜å…ƒç´ å¤–è§‚ã€‚

## 5.5 æ ¡éªŒAngularJSè¡¨å•

### ç†è§£ngFormController

> æ¯ä¸ªformæˆ–ngFormæŒ‡ä»¤éƒ½åˆ›å»ºngFormControllerçš„ä¸€ä¸ªå®ä¾‹ã€‚ngFormControllerå¯¹è±¡ç®¡ç†è¡¨å•çš„validæˆ–invalidã€pristineæˆ–dirtyçŠ¶æ€ï¼Œé‡ç‚¹æ˜¯å®ƒä¸ngModelControllerååŒå·¥ä½œä»¥è·Ÿè¸ªè¡¨å•ä¸­çš„æ¯ä¸ªngModelå­—æ®µã€‚
>
> å½“ngModelControllerè¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°†è‡ªå·±æ³¨å†Œç»™å…¶çˆ¶å…ƒç´ åˆ—è¡¨ä¸­æœ€è¿‘çš„ngFormControllerã€‚è¿™æ ·ï¼ŒngFormControllerå°±äº†è§£å®ƒ åº”è¯¥è¿½è¸ªå“ªäº›è¾“å…¥æŒ‡ä»¤ï¼Œå®ƒå¯ä»¥æ£€æŸ¥è¿™äº›å­—æ®µæ˜¯å¦ä¸ºvalid/invalidæˆ–pristine/dirtyï¼Œå¹¶ç›¸åº”åœ°å°†è¡¨å•è®¾ç½®ä¸ºvalid/invalidæˆ–pristine/dirtyçŠ¶æ€ã€‚

#### è¿ç”¨nameå±æ€§å°†è¡¨å•é™„åŠ åˆ°ä½œç”¨åŸŸä¸Š

> å¯ä»¥ç»™è¡¨å•å‘½åï¼Œä»¥ä½¿ngFormControllerå‡ºç°åœ¨æœ¬åœ°ä½œç”¨åŸŸä¸Šï¼Œè¡¨å•ä¸­ä»»ä½•æœ‰åå­—çš„è¾“å…¥å…ƒç´ ä¹Ÿä¼šæœ‰å®ƒä»¬çš„ngModelControllerå¯¹è±¡ï¼Œå…¶ä½œä¸ºå±æ€§ä¼šè¢«é™„åŠ åˆ°ngFormControllerå¯¹è±¡ã€‚

### ä¸ºç”¨æˆ·ä¿¡æ¯è¡¨å•å¢åŠ åŠ¨æ€è¡Œä¸º

#### æ˜¾ç¤ºéªŒè¯é”™è¯¯

ä¸€ä¸ªğŸŒ°ï¼š

è¿™é‡ŒngFormCintrolleræ˜¯userInfoForm

ngModelControlleræ˜¯userInfoFormè¡¨å•ä¸­çš„æ¯ä¸€ä¸ªå­—æ®µ

```html
// html
<form name="userInfoForm">
                <div class="control-group" ng-class="vm.getCssClasses(userInfoForm.email)">
                    <label>Email</label>
                    <input type="email" ng-model="vm.user.email" name="email" required>
                    <span ng-show="vm.showError(userInfoForm.email, 'email')" class="help-inline">You must enter a valid email.</span>
                    <span ng-show="vm.showError(userInfoForm.email, 'required')" class="help-inline">This field is required</span>
                </div>
</form>   
```

```css
// css 
.success {
    color: black;
}
.error {
    color: red;
} 
```

```javascript
// controller
 vm.getCssClasses = function (ngModelController) {
            return {
                error: ngModelController.$invalid && ngModelController.$dirty,
                success: ngModelController.$valid && ngModelController.$dirty
            };
        };
        vm.showError = function (ngModelController, error) {
            return ngModelController.$error[error];
        }  
```

#### è®©ä¿å­˜æŒ‰é’®æ— æ•ˆ

```html
<button ng-disabled="!vm.canSave()" ng-class="{'error':!vm.canSave()}">æäº¤</button>
```

```javascript
$scope.canSave = function($scope) {
  return $scope.userInfoForm.$dirty && $scope.userInfoForm.&valid;
}
```

è¿™é‡Œæ³¨æ„userInfoFormæ˜¯æŒ‚è½½åœ¨$scopeä¸Šçš„ã€‚

### ä½¿åŸå£°æµè§ˆå™¨çš„æ ¡éªŒæ— æ•ˆ

ä½¿ç”¨`novalidate`æŒ‡ä»¤å¯ä»¥å…³æ‰æµè§ˆå™¨çš„æ ¡éªŒ

```javascript
<form name="xxxx" novalidate></form>
```

## 5.6 åœ¨å…¶å®ƒè¡¨å•ä¸­åµŒå¥—è¡¨å•

AngularJSè¡¨å•å¯ä»¥ç›¸äº’åµŒå¥—ã€‚

> å› ä¸ºåœ¨formæ ‡ç­¾ä¸­å†åŠ å…¥formæ ‡ç­¾æ˜¯æ— æ•ˆçš„HTMLï¼Œæ‰€ä»¥AngularJSä¸ºåµŒå¥—è¡¨å•æä¾›äº† ngFormæŒ‡ä»¤ã€‚

### å°†å­è¡¨å•ä½œä¸ºå¯é‡ç”¨ç»„ä»¶

> åµŒå¥—è¡¨å•çš„è¡Œä¸ºåƒå¤åˆå­—æ®µï¼Œå®ƒåŸºäºåŒ…å«çš„å­—æ®µæš´éœ²è‡ªå·±çš„éªŒè¯ä¿¡æ¯ï¼Œè¿™æ ·çš„è¡¨å•å¯ä½œä¸ºå­è¡¨å•å¤ç”¨åœ¨æ›´å¤§çš„å®¹å™¨è¡¨å•ä¸­ã€‚

è¿™é‡Œä½¿ç”¨templateæ¨¡ç‰ˆã€‚æŠŠå®ƒincludeè¿›å»ã€‚

ä¸¾ä¸ªğŸŒ°

```javascript
<!--åµŒå¥—è¡¨å•-->
        <script type="text/ng-template" id="password-form">
            <ng-form name="passwordForm">
                <div ng-show="vm.user.password !== vm.user.password2">
                    Passwords do not match!
                </div>
                <label>Passwordï¼š</label>
                <input ng-model="vm.user.password" type="password" required>
                <label>Confirm Passwordï¼š</label>
                <input ng-model="vm.user.password2" type="password" required>
            </ng-form>
        </script>
        <div>
            <form name="form1" novalidate>
                <legend>User Form</legend>
                <label>Name</label>
                <input ng-model="vm.user.name" required>
                <ng-include src="'password-form'"></ng-include>
            </form>
        </div>
```

## 5.7 é‡å¤å­è¡¨å•

æƒ…æ™¯ï¼šæŸä¸€ä¸ªå­—æ®µå¯ä»¥å¡«å†™ä¸æ­¢ä¸€ä¸ªå†…å®¹ï¼Œä¾‹å¦‚å–œæ¬¢çš„é¢œè‰²å¯ä»¥æ˜¯èµ¤ã€æ©™ã€é»„ï¼Œç»¿ç­‰ã€‚

è¿™é‡Œä½¿ç”¨ng-repeatã€‚ä½†æ˜¯è¢«å¡«å…¥çš„å­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ•°ç»„ã€‚

ä¸¾ä¸ªğŸŒ°ï¼Œè¢«repeatçš„å¯¹è±¡åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```javascript
$scope.user = [
  {url: 'xxxx'},
  {url: 'xxxx'},
  {url: 'xxxx'}
]
```

### éªŒè¯é‡å¤è¾“å…¥

ç»™æœ‰å¤šä¸ªå†…å®¹çš„å­—æ®µæ·»åŠ ä¸€ä¸ªç»Ÿä¸€çš„æ ¡éªŒï¼Œä¸¾ä¸€ä¸ªğŸŒ°ï¼š

```html
<form novalidate name="userForm">
            <label>Websites</label>
            <div ng-show="userForm.$invalid">The User Form is invalid.</div>
            <div ng-repeat="website in vm.user.websites" ng-form="websiteForm">
                <input type="url" name="website" ng-model="website.url" required>
                <button ng-click="vm.remove($index)">x</button>
                <span ng-show="vm.showError(websiteForm.website, 'url')">Please must enter a valid url</span>
                <span ng-show="vm.showError(websiteForm.website, 'required')">This field is required.</span>
            </div>
            <button ng-click="vm.add()">Add Website</button>
        </form>
```

```javascript
// åµŒå¥—è¡¨å•
vm.user.websites = [
  { url: 'http://www.bloggs.com'},
  { url: 'http://www.jo-b.com'}
];
// åˆ é™¤websites
vm.remove = function (index) {
  vm.user.websites.splice(index, 1);
};
// æ·»åŠ websites
vm.add = function () {
  vm.user.websites.push({ url: '' });
}
vm.showError = function (ngModelController, error) {
  return ngModelController.$error[error];
};
```

ä¸»è¦åˆ©ç”¨å¯¹äºå¤–å±‚è¡¨å•`userForm`æ¥è¯´ï¼Œå¦‚æœå†…éƒ¨è¡¨å•`websiteForm`æœ‰ä¸€ä¸ªæ˜¯æ— æ•ˆçš„ï¼Œé‚£ä¹ˆ`userForm`ä¹Ÿæ˜¯æ— æ•ˆçš„ã€‚æ‰€ä»¥å¯ä»¥åˆ©ç”¨`userForm.$invalid`ä¸º`true`æ—¶ï¼Œæ˜¾ç¤ºæ€»ä½“é”™è¯¯ä¿¡æ¯ã€‚

## 5.8 å¤„ç†ä¼ ç»Ÿçš„HTMLè¡¨å•æäº¤

### ç›´æ¥å‘æœåŠ¡å™¨æäº¤è¡¨å•

> åœ¨AngularJsçš„åº”ç”¨ä¸­ï¼Œå¦‚æœè¡¨å•åŒ…å«äº†actionå±æ€§ï¼Œè¡¨å•å°±ä¼šåƒactionæ‰€å®šä¹‰çš„URLè¿›è¡Œæ­£å¸¸æäº¤ã€‚

ä¸¾ä¸€ä¸ªğŸŒ°

```html
<form action="http://www.google.com/search" method="get">
     <input name="q">ä½¿ç”¨å›è½¦æäº¤è¡¨å•
</form>
```

### å¤„ç†è¡¨å•æäº¤äº‹ä»¶

> å¦‚æœæ²¡æœ‰åŒ…å«actionå±æ€§ï¼Œåˆ™AngularJSå‡å®šæˆ‘ä»¬æƒ³è¦åœ¨å®¢æˆ·ç«¯å¤„ç†æäº¤äº‹ä»¶ï¼Œé€šè¿‡åœ¨ä½œç”¨åŸŸä¸Šè°ƒç”¨ä¸€ä¸ªå‡½æ•°å®ç°ã€‚æ­¤æ—¶ï¼ŒAngular JSå°†é˜»æ­¢è¡¨å•å¯¹æœåŠ¡å™¨çš„ç›´æ¥æäº¤ã€‚
>
> å¯ä»¥åˆ©ç”¨buttonä¸Šçš„ngClickæŒ‡ä»¤ï¼Œæˆ–formä¸Šçš„ngSubmitæŒ‡ä»¤ï¼Œæ¥å‡ºå‘è¯¥å®¢æˆ·ç«¯å‡½æ•°ã€‚
>
> ä¸åº”åœ¨åŒä¸€è¡¨å•ä¸­æ—¢ä½¿ç”¨ngsubmitæŒ‡ä»¤ï¼Œåˆä½¿ç”¨ngClickæŒ‡ä»¤ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæŒ‡ä»¤æµè§ˆå™¨éƒ½è§¦å‘ï¼Œé€ æˆåŒé‡æäº¤ã€‚

#### ä½¿ç”¨ngSubmitå¤„ç†è¡¨å•æäº¤

> ä¸ºäº†åœ¨è¡¨å•ä¸­åº”ç”¨ngSubmitï¼Œéœ€è¦æä¾›ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒä¼šåœ¨è¡¨å•è¢«æäº¤æ—¶è¿›è¡Œæ±‚å€¼ã€‚è¡¨å•æäº¤å°†ä¼šåœ¨ç”¨æˆ·è¾“å…¥å…¶ä¸­ä¹‹ä¸€æŒ‰ä¸‹Enteré”®æˆ–ç‚¹å‡»ç›¸åº”æŒ‰é’®æ—¶å‘ç”Ÿã€‚

ä¸¾ä¸€ä¸ªğŸŒ°ï¼š

```html
<form ng-submit="vm.showAlert(q)">
	<input ng-model="q">ng-submit æäº¤è¡¨å•
</form>
```

> **ngSubmitåº”åªç”¨äºä»…æœ‰ä¸€ä¸ªè¾“å…¥å’Œä¸å¤šäºä¸€ä¸ªæŒ‰é’®çš„è¡¨å•ã€‚**

#### ä½¿ç”¨ngClickå¤„ç†è¡¨å•æäº¤

ä¸¾ä¸€ä¸ªğŸŒ°ï¼š

```html
<form>
    <input ng-model="q">
    <button ng-click="showAlert(q)">Search</button>
</form>
```

## 5.9 é‡ç½®ç”¨æˆ·ä¿¡æ¯è¡¨å•

```javascript
// æ¸…ç©ºè¡¨å•
vm.revert = function () {
  vm.user = angular.copy(original); // è·å–åŸå§‹çŠ¶æ€
  vm.passwordRepeat = vm.user.password;
  scope.userInfoForm.$setPristine(); // è¯¥æ–¹æ³•ç”¨äºè®¾ç½®æ§åˆ¶åˆ°åŸå§‹çŠ¶æ€ã€‚ è¯¥æ–¹æ³•å¯ä»¥ç§»é™¤'ng-dirty'ç±»å¹¶å°†æ§åˆ¶æ¢å¤åˆ°åŸå§‹çŠ¶æ€('ng-pristine'ç±»)ã€‚
}
```







