# 第六章 导航

## 6.1 单页Web应用的URL

互联网初期，URL只用来指定服务器上一个单一的物理资源。页面加载后，就可以点击链接跳转到其它资源，或者使用前进后退按钮来跳转到已访问的页面。

动态生成的页面，则不是上述的样子。即使是相同的URL，应用内部逻辑的变化也可以显示不同页面的内容。前进后退按钮在这种情况下也会受到影响。

单页Web应用情况更不一样。在重度依赖Ajax的应用中，地址栏中往往只能看到一个URL，之后的HTTP交互都是通过XHR对象实现的，浏览器地址栏不会有任何变化。这时前进后退按钮完全不起作用，点击后可能会跳转到其它网站，而不是当前应用的其它页面。

### HTML5之前的Hashbang URL

### HTML5和history API

> 使用history API，可以模拟访问网页而不是真的向服务器发送请求。使用新的history.pushState方法，可以把这些完整而又直观的URL推送到浏览器的history堆栈。

## 6.2 使用$location服务

### 理解$location服务API与URL的关系

### 哈希、页面内导航和$anchorScroll

### 配置HTML5方式的URL

> AngularJS 的URL会默认使用hashbang方式，想要使用之冠的HTML方式，则需要修改Angular JS的默认配置，以及让服务端也支持可收藏的URL格式。

#### 客户端

```javascript
$locationProvider.html5Mode(true);
```

#### 服务端

> 为了让HTML5模式正常使用，还需要服务端的支持，也就是说，当浏览器请求访问深层链接时，服务端要能重定向到单页Web应用的起始页面。
>
> 三种URL类型需要web服务器进行处理。
>
> - 指向图片、CSS文件、Angular JS局部文件等静态资源的URL。
> - 获取后端数据或修改数据的请求URL。
> - 代表应用功能且以HTML5模式显示的URL，服务器需要跳转到应用的起始页面。

### 使用$location导航

#### 根据路由构件页面

#### 路由映射URL

#### 定义路由时指定控制器

#### 导航的不足

> $location服务的API不只对浏览器原生API进行良好的封装，还兼容了不同的URL模式。

## 6.3 使用Angular JS自带的路由服务

包含在angular-route.js中，需要依赖ngRoute模块。

### 基础路由定义

#### 显示匹配的路由内容

> 当一个URL匹配路由时，将使用ng-view指令显示路由的内容。
>
> ngView指令可以通过当前匹配的路由找到要显示的内容。

### 匹配灵活的路由

#### 定义默认路由

> 通过otherwise方法，可以设置默认路由。默认路由只能有一个，所以不需要制定人和URL。
>
> 没有指定路径的URL或者路径无效的URL都会匹配到默认路由，触发相应的路由更新时间。

#### 访问路由参数

> URL路由定义可以包含变量作为参数。当一个路由匹配到URL时，使用$routeParams服务就能轻松获取这些参数值。实际上，$routeParams服务也是一个🍳简单的JS对象（哈希），哈希健是路由参数名称，哈希值是从匹配的URL解析出来的字符串。
>
> $routeParams作为一个服务，也可以被Angular JS依赖反转系统注入任何对象。

### 多个控制器重用局部模版

> AngularJS路由系统还允许在路由级别上定义控制器。将控制器从局部模版中抽离，降低耦合度。

> 将控制器声明移到路由定义中，相同的控制器就可以用于不同的局部模板。
>
> 多个控制器能重用相同的局部模板。

### 路由改变时避免UI抖动

> 当应用切换时，会将新页面的元素显示出来，同时获取相应的实体数据。渲染新页面有两种方式。
>
> - 尽早显示新页面元素，从后端获取到数据后，再重新渲染显示UI。
> - 等待所有后端数据都获取到后再显示新页面元素。

Angular JS默认使用第一种方式。这样容易出现页面抖动，因为渲染了两次。

Angular JS支持第二种方式：等待数据就绪后，才会更新路由以及重新渲染UI。

在路由定义时指定resolve属性，将路由控制器所有依赖的异步数据都罗列出来，Angular JS会确保所有依赖条件都满足后才进行路由更新及初始化控制器。

### 取消路由更新

> 路由定义的resolve属性支持终止页面跳转。只要resolve键值中的promise被拒绝，Angular JS就取消页面跳转，UI也不会进行更新。
>
> 需要留意的是，如果取消路由更新，则浏览器地址栏的URL不会被恢复。

## 6.4 $route服务的局限

### 一个路由只对应页面中的一个区域

> ng-view指令表示DOM元素的内容要被路由定义的内容替换，在$route服务中，一个路由只能影响UI中的一块内容。
>
> 事实上，当路由变化时，经常需要更新页面上的多个区域。

#### 使用ng-include处理多个UI区域

> 路由定义对象是个普通的JS对象，也可以包含自定义属性。
>
> 这种方法最然能达到我们想要的视觉效果，但是每次更新路由菜单的DOM元素都会被渲染。一旦局部模版要进行耗资源的处理就得谨慎应对。

### 不支持嵌套路由

> 路由系统的另一个缺点是不支持嵌套路由，只能有一个ng-view指令。

## 6.5 路由相关的模式及技巧

### 处理链接

#### 创建可点击的链接

用a标签实现页面跳转有两种方式：

使用href和ng-cilck。

> 实际上这两种方法存在细微的差别。使用href属性创建的链接对用户来说友好一点，用户可以同过右键点击链接，并选择在浏览器新的标签页或窗口打开。

#### 兼容HTML5及hashbang模式

> Angular JS 采用$location服务可以配置使用hashbang或者HTML5两种模式，不管采用哪种模式，都需要在配置块中预先指定，链接也要根据所选模式创建。

#### 链接外部页面

有时，想要让链接指向某个外部资源，在HTML5模式下，通过URL地址无法区分，可以使用target属性来解决这个问题。

### 组织路由定义

 #### 将路由定义分离到多个模块

#### 减少路由定义的重复代码

> 可以编写自定义的provider，对$routeProvider服务器进行封装，以减少代码重复。

