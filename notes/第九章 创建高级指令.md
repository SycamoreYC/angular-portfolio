# ç¬¬ä¹ç«  åˆ›å»ºé«˜çº§æŒ‡ä»¤

é‡ç‚¹ï¼š

- ç†è§£åµŒå…¥ï¼šå°¤å…¶æ˜¯æŒ‡ç†è§£åµŒå…¥å‡½æ•°å’ŒåµŒå…¥ä½œç”¨åŸŸçš„ç”¨æ³•ã€‚
- å®šä¹‰è‡ªå·±çš„æŒ‡ä»¤æ§åˆ¶å™¨æ¥å®ç°æŒ‡ä»¤ä¹‹é—´çš„ç›¸äº’åä½œï¼Œç†è§£æŒ‡ä»¤æ§åˆ¶å™¨ä¸é“¾æ¥å‡½æ•°çš„åŒºåˆ«ã€‚
- ç»ˆæ­¢å¹¶æ¥ç®¡æŒ‡ä»¤ç¼–è¯‘è¿‡ç¨‹ï¼šåŠ¨æ€åŠ è½½è‡ªå®šä¹‰æ¨¡ç‰ˆï¼Œä»¥åŠä½¿ç”¨$compileå’Œ$interpolateæœåŠ¡ã€‚

## 9.1 ä½¿ç”¨åµŒå…¥

> å½“å…ƒç´ ä»DOMä¸­çš„ä¸€ä¸ªåœ°æ–¹ç§»åˆ°å¦å¤–ä¸€ä¸ªåœ°æ–¹ï¼Œå¿…é¡»è¯´æ˜ä¸å…¶å…³è”çš„ä½œç”¨åŸŸå¦‚ä½•å˜åŒ–ã€‚
>
> ç®€å•ç›´æ¥çš„åŠæ³•å°±æ˜¯ä¸ºè¯¥å…ƒç´ å…³è”å…¶æ–°ä½ç½®å®šä¹‰çš„æ–°ä½œç”¨åŸŸã€‚ä½†è¿™æ ·å¯èƒ½ä¼šå½±å“åº”ç”¨çš„é€»è¾‘ï¼Œå› ä¸ºå…ƒç´ æ— æ³•å†è®¿é—®å…¶åŸå§‹ä½œç”¨åŸŸä¸­çš„æ•°æ®ã€‚
>
> è¿™ç§ç§»åŠ¨å…ƒç´ æ—¶ï¼Œå°†å…¶å…³è”ä½œç”¨åŸŸä¸€èµ·ç§»åŠ¨çš„åšæ³•å°±æˆä¸ºåµŒå…¥ã€‚

### åœ¨æŒ‡ä»¤ä¸­ä½¿ç”¨åµŒå…¥

> å½“ä¸€ä¸ªæŒ‡ä»¤çš„åŸå§‹æ ‡ç­¾å†…å®¹è¢«æ–°å…ƒç´ æ›¿æ¢ï¼Œä½†åŒæ—¶åˆéœ€è¦åœ¨æ–°å…ƒç´ çš„æŸäº›åœ°æ–¹ä½¿ç”¨åˆ°åŸå§‹å†…å®¹æ—¶ï¼Œå°±å¿…é¡»ä½¿ç”¨åµŒå…¥ã€‚

### åœ¨ç‹¬ç«‹ä½œç”¨åŸŸæŒ‡ä»¤ä¸­ä½¿ç”¨åµŒå…¥

> åµŒå…¥æœ€å¸¸è§çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæœ‰æ¨¡ç‰ˆç»„ä»¶çš„æŒ‡ä»¤ï¼Œç„¶ååœ¨æ¨¡ç‰ˆä¸­çš„æŸä¸ªä½ç½®æ’å…¥åŸå§‹å…ƒç´ çš„å†…å®¹ã€‚

### åˆ›å»ºä¸€ä¸ªä½¿ç”¨åµŒå…¥çš„æç¤ºæŒ‡ä»¤

```javascript
angular.module('comAlert')
        .directive('alert', config);

    function config() {
        return {
            restrict: 'E',
            replace: true,
            transclude: true,
            templateUrl: '../src/components/alert/alert.tpl.html',
            scope: {
                type: '=',
                close: '&'
            }
        }
    }
```

#### ç†è§£æŒ‡ä»¤ä¸­çš„replaceå±æ€§

> replaceå±æ€§ä¼šå‘Šè¯‰ç¼–è¯‘å™¨ä½¿ç”¨templateå­—æ®µæ‰€æä¾›çš„æ¨¡ç‰ˆæ¥æ›¿æ¢åŸå§‹çš„æŒ‡ä»¤å…ƒç´ ã€‚å¦‚æœåªæä¾›templateä½†æ²¡æœ‰å®šä¹‰replaceï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šå°†æ¨¡ç‰ˆè¿½åŠ åˆ°æŒ‡ä»¤å…ƒç´ ä¸­ã€‚

#### ç†è§£æŒ‡ä»¤å®šä¹‰ä¸­çš„transcludeå±æ€§

> transcludeå±æ€§çš„å€¼è¦ä¹ˆæ˜¯trueï¼Œè¦ä¹ˆæ˜¯elementã€‚è¿™ä¸ªå±æ€§å‘Šè¯‰ç¼–è¯‘å™¨å–å‡ºåŸå§‹<alert>å…ƒç´ çš„å†…å®¹ï¼Œä¿è¯å…¶åœ¨åµŒå…¥æ¨¡ç‰ˆæ—¶å¯ç”¨ã€‚
>
> - transclude: trueè¡¨ç¤ºæŒ‡ä»¤å…ƒç´ çš„å†…å®¹ï¼ˆå­å…ƒç´ ï¼‰ä¼šè¢«åµŒå…¥ã€‚
> - transcluydeï¼šelementè¡¨ç¤ºæ•´ä¸ªå…ƒç´ ä¼šè¢«åµŒå…¥ï¼ŒåŒ…æ‹¬é‚£äº›å°šæœªè¢«ç¼–è¯‘çš„å±æ€§æŒ‡ä»¤ã€‚ ng-repeatå°±æ˜¯è¿™ç§å½¢å¼ã€‚

#### ä½¿ç”¨ng-transcludeæ’å…¥åµŒå…¥å…ƒç´ 

> ng-transcludeæŒ‡ä»¤ä¼šå¾—åˆ°åµŒå…¥å…ƒç´ ï¼Œç„¶åå°†åµŒå…¥å…ƒç´ è¿½åŠ åˆ°æ¨¡ç‰ˆå…ƒç´ ä¸­ng-transcludeæ‰€åœ¨çš„ä½ç½®ã€‚

### ç†è§£åµŒå…¥ä½œç”¨åŸŸ

> æŒ‡ä»¤å…ƒç´ çš„åŸå§‹å†…å®¹å°†ä¼šè¢«æ’å…¥æ¨¡ç‰ˆä¸­ï¼Œå®ƒéœ€è¦ä¸æŒ‡ä»¤çš„åŸå§‹ä½œç”¨åŸŸå…³è”èµ·æ¥ï¼Œè€Œä¸”è¯¥ä½œç”¨åŸŸä¸æ˜¯ç‹¬ç«‹ä½œç”¨åŸŸã€‚é€šè¿‡åµŒå…¥åŸå§‹å…ƒç´ ï¼Œå°±å¯ä»¥ä¸ºæ¨¡ç‰ˆå…ƒç´ æä¾›ä¸€ä¸ªæ­£ç¡®çš„ä½œç”¨åŸŸã€‚

> å½“å…ƒç´ è¢«åµŒå…¥æ¨¡ç‰ˆä¸­çš„æŸä¸ªä½ç½®æ—¶ï¼Œä»–ä»¬ä¼šå¸¦ç€ä¹‹å‰ç»‘å®šåœ¨å®ƒä»¬èº«ä¸Šçš„åŸå§‹ä½œç”¨åŸŸä¸€èµ·è¿å¾™ã€‚æ›´å‡†ç¡®çš„è¯´æ³•æ˜¯ï¼ŒåµŒå…¥å…ƒç´ ä¼šç»‘å®šä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œè€Œè¯¥ä½œç”¨åŸŸåŸå‹ç»§æ‰¿è‡ªè¯¥å…ƒç´ å½“åˆè¯ç”Ÿåœ°æ‰€åœ¨çš„ä½œç”¨åŸŸã€‚

## 9.2 åˆ›å»ºå’Œä½¿ç”¨åµŒå…¥å‡½æ•°

> Angular JSä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨åµŒå…¥å‡½æ•°æ¥å®ç°åµŒå…¥ã€‚åµŒå…¥å‡½æ•°å®é™…ä¸Šå°±æ˜¯é€šè¿‡è°ƒç”¨$compileæœåŠ¡åˆ›å»ºçš„é“¾æ¥å‡½æ•°ã€‚
>
> å½“ä¸€ä¸ªæŒ‡ä»¤è¦æ±‚åµŒå…¥æ—¶ï¼ŒAngularJSå°±ä¼šä»DOMä¸­æå–å¯¹åº”çš„åµŒå…¥å…ƒç´ ï¼Œç„¶åå¯¹å®ƒè¿›è¡Œç¼–è¯‘ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œé™¤äº†ç”¨ng-transcludeçš„æ–¹å¼è¿˜å¯ä»¥ç”¨å‡½æ•°çš„æ–¹å¼ä½¿å…ƒç´ åµŒå…¥ã€‚

```javascript
var eleToTransclude = directiveEle.contents(); // è·å–å¸Œæœ›è¢«åµŒå…¥çš„å†…å®¹
directiveELe.html(''); // æ¸…ç©ºåŒ…å«è¢«åµŒå…¥å…ƒç´ çš„æŒ‡ä»¤
var transcludeFunction = $compile(eleToTransclude); // ç¼–è¯‘è¢«åµŒå…¥å†…å®¹ç”Ÿæˆä¸€ä¸ªåµŒå…¥å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›ç»™æŒ‡ä»¤ä¾›å…¶ä½¿ç”¨
```

### ä½¿ç”¨$compileæœåŠ¡åˆ›å»ºä¸€ä¸ªåµŒå…¥å‡½æ•°

> AngularJSçš„ç¼–è¯‘å™¨å¯¹å¤–ä»¥$compileæœåŠ¡çš„å½¢å¼æš´éœ²å‡ºæ¥ã€‚è¯¥æœåŠ¡å°±æ˜¯Angular JSç”¨æ¥ç¼–è¯‘åº”ç”¨çš„ç¼–è¯‘å‡½æ•°ã€‚ä½¿ç”¨è¯¥æœåŠ¡ï¼Œåªéœ€åœ¨è°ƒç”¨æ—¶ä¼ é€’ä¸€ä¸ªDOMèŠ‚ç‚¹åˆ—è¡¨ä½œä¸ºå‚æ•°å³å¯ã€‚

```javascript
var linkingFn = $compile('<div some-directive>Some {{"interpola-ted"}} values</div>');
```

è°ƒç”¨$compileæœåŠ¡ä¼šè¿”å›ä¸€ä¸ªé“¾æ¥å‡½æ•°ã€‚è°ƒç”¨è¯¥é“¾æ¥å‡½æ•°ï¼Œä¼ é€’ä¸€ä¸ª ä½œç”¨åŸŸ ä½œä¸ºå‚æ•°ï¼Œåˆ™ä¼š ç”Ÿæˆ ä¸€ä¸ªç¼–è¯‘ä¹‹åç»‘å®šåœ¨æŒ‡å®šä½œç”¨åŸŸä¸Šçš„DOMå…ƒç´ ã€‚

```javascript
var compiledEle = linkingFn(someScope);
```

#### åœ¨åµŒå…¥æ—¶å…‹éš†åŸå§‹å…ƒç´ 

> å¦‚æœåœ¨è°ƒç”¨é“¾æ¥å‡½æ•°æ—¶ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆé“¾æ¥å‡½æ•°ä¸ä¼šåƒä¸ŠèŠ‚é‚£æ ·è¿”å›ç¼–è¯‘åçš„ å…ƒç´ ï¼Œè€Œæ˜¯è¿”å›è¯¥å…ƒç´ çš„ä¸€ä¸ªå…‹éš†å‰¯æœ¬ã€‚åŒæ—¶å›è°ƒå‡½æ•°ä¹Ÿä¼šè¢«ä¼ å…¥å…‹éš†å…ƒç´ ä½œä¸ºå‚æ•°è¿›è¡Œè°ƒç”¨ã€‚

```javascript
var clone = linkingFn(scope, function(clone) {
  element.append(clone);
})
```

### åœ¨æŒ‡ä»¤ä¸­è®¿é—®åµŒå…¥å‡½æ•°

> ç¼–è¯‘å™¨ä¼šå°†åµŒå…¥å‡½æ•°ä¼ å›ç»™æŒ‡ä»¤ã€‚
>
> æœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥è®¿é—®åµŒå…¥å‡½æ•°ï¼šç¼–è¯‘å‡½æ•° ä¸­å’Œ æŒ‡ä»¤æ§åˆ¶å™¨ä¸­ã€‚

```javascript
myModule.directive('myDirective', function() {
  return {
    transclude: 'true',
    compile: function(ele, attrs, transcludeFn) {
      ...
    },
    controller: function($scope, $transclude) {
      ...
    }
  };
});
```

ğŸ‘†ä»£ç ä¸­ï¼Œå£°æ˜æŒ‡ä»¤åº”è¯¥ä½¿ç”¨åµŒå…¥ï¼ˆtransclude: trueï¼‰ã€‚å¯ä»¥é€šè¿‡transcludeFnå‚æ•°æ¥è®¿é—®ç¼–è¯‘å‡½æ•°ä¸­çš„åµŒå…¥å‡½æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡$transcludeå‚æ•°è®¿é—®æŒ‡ä»¤æ§åˆ¶å™¨ä¸­çš„åµŒå…¥å‡½æ•°ã€‚

#### é€šè¿‡ç¼–è¯‘å‡½æ•°ä¸­çš„transcludeFnæ¥è·å–åµŒå…¥å‡½æ•°

å¯ä»¥é€šè¿‡æŒ‡ä»¤ç¼–è¯‘å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ¥è·å–åµŒå…¥å‡½æ•°ã€‚åœ¨ç¼–è¯‘é˜¶æ®µï¼Œå› ä¸ºä½œç”¨åŸŸå°šæœªç¡®å®šï¼Œæ‰€ä»¥åµŒå…¥å‡½æ•°å¹¶æ²¡æœ‰ç»‘å®šäººå’Œä½œç”¨åŸŸã€‚å› æ­¤ï¼Œå½“è°ƒç”¨åµŒå…¥å‡½æ•°æ—¶ï¼Œéœ€è¦å°†ä½œç”¨åŸŸä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å®ƒã€‚

åœ¨é“¾æ¥å‡½æ•°ä¸­ä½œç”¨åŸŸå·²ç»ç¡®å®šï¼Œå› æ­¤ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒåµŒå…¥å‡½æ•°éƒ½ä¼šåœ¨é“¾æ¥å‡½æ•°ä¸­è¢«è°ƒç”¨ã€‚

```javascript
compileï¼š function(ele, attrs, transcludeFn) {
  return function postLink(scope, ele, attrs, controller ){
    var newScope = scope.$parent.$new();
    ele.find('p').first().append(transcludeFn(newScope)); // å°†åµŒå…¥å…ƒç´ æ’å…¥æŒ‡ä»¤å…ƒç´ ä¸­çš„ç¬¬ä¸€ä¸ª<p>å…ƒç´ ä¸­ã€‚
    // å½“è°ƒç”¨åµŒå…¥å‡½æ•°(transcludeFn)æ—¶ï¼Œå°†åµŒå…¥å…ƒç´ ç»‘å®šåˆ°ä¸€ä¸ªä½œç”¨åŸŸä¸Šã€‚æœ¬ä¾‹åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œè¯¥ä½œç”¨åŸŸæ—¶æŒ‡ä»¤çˆ¶ä½œç”¨åŸŸçš„å­ä½œç”¨åŸŸï¼Œä¹Ÿå°±æ˜¯æŒ‡ä»¤ä½œç”¨åŸŸçš„å…„å¼Ÿä½œç”¨åŸŸã€‚
  }
}
```

å½“æŒ‡ä»¤ä½¿ç”¨ç‹¬ç«‹ä½œç”¨åŸŸæ—¶ï¼Œåƒä¸Šé¢ä»£ç ä¸­é‚£æ ·ç»™åµŒå…¥å‡½æ•°ä¼ é€’ä½œç”¨åŸŸæ˜¯å¿…é¡»çš„ã€‚

å› ä¸ºæ­¤æ—¶ä¼ é€’ç»™é“¾æ¥å‡½æ•°ä½œç”¨åŸŸæ˜¯æŒ‡ä»¤çš„ç‹¬ç«‹ä½œç”¨åŸŸï¼Œè¯¥ä½œç”¨åŸŸå¹¶æ²¡æœ‰ç»§æ‰¿çˆ¶ä½œç”¨åŸŸå±æ€§ï¼Œè€ŒåµŒå…¥å…ƒç´ æ°æ°éœ€è¦è¿™äº›å±æ€§ï¼Œæ‰€ä»¥éœ€è¦ç»™åµŒå…¥å‡½æ•°ä¸“é—¨ä¼ é€’ä½œç”¨åŸŸã€‚

#### é€šè¿‡$transcludeåœ¨æŒ‡ä»¤æ§åˆ¶å™¨ä¸­è·å–åµŒå…¥å‡½æ•°

> å¯ä»¥é€šè¿‡å‘æŒ‡ä»¤æ§åˆ¶å™¨æ³¨å…¥$transcludeæ¥è·å–åµŒå…¥å‡½æ•°ã€‚
>
> åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œ$transcludeæ˜¯ä¸€ä¸ªå·²ç»é¢„å…ˆç»‘å®šäº†æ–°ä½œç”¨åŸŸï¼ˆæ–°ä½œç”¨åŸŸæ˜¯åµŒå…¥å…ƒç´ çˆ¶ä½œç”¨åŸŸçš„å­ä½œç”¨åŸŸï¼‰çš„å‡½æ•°ï¼Œæ‰€ä»¥è°ƒç”¨æ—¶ï¼Œæ— éœ€æä¾›ä½œç”¨åŸŸã€‚

```javascript
controller: function($scope, $element, $transclude) {
  $element.find('p').first().append($transclude());
}
```

ğŸ‘†åœ¨æ§åˆ¶å™¨ä¸­ï¼Œå†ä¸€æ¬¡å°†åµŒå…¥å…ƒç´ æ’å…¥æŒ‡ä»¤å…ƒç´ ä¸­çš„ç¬¬ä¸€ä¸ª<p>ä¸­ã€‚

> ä½¿ç”¨$transcludeæ—¶ï¼Œé¢„å…ˆç»‘å®šçš„ä½œç”¨åŸŸæ—¶åŸå‹ç»§æ‰¿è‡ªåµŒå…¥å…ƒç´ çˆ¶ä½œç”¨åŸŸçš„å­ä½œç”¨åŸŸã€‚

### ä½¿ç”¨åµŒå…¥åˆ›å»ºä¸€ä¸ªifæŒ‡ä»¤

ä¸Šé¢è¯´äº†é‚£ä¹ˆå¤šï¼Œå°±æ˜¯è¯´ä½¿ç”¨åµŒå…¥å‡½æ•°ï¼Œä¸ng-transcludeå¯ä»¥è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœã€‚

ä¸¾ä¸€ä¸ªğŸŒ°ï¼š

åˆ›å»ºä¸€ä¸ªifæŒ‡ä»¤ï¼Œè®©å…ƒç´ åœ¨ä¸è¢«éœ€è¦çš„æ—¶å€™ä»DOMä¸­ç§»é™¤ã€‚

```javascript
 angular.module('comIf')
        .directive('if', config);

    function config() {
        return {
            // æŒ‡ä»¤åµŒå…¥æ•´ä¸ªå…ƒç´ 
            transclude: 'element', 
            priority: 500,
            compile: function (ele, attr, transclude) {
                return function postLink(scope, ele, attr) {
                    var childEle, childScope;
                  
					// å½“è¡¨è¾¾å¼çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¦‚æœæŒ‡ä»¤å¯¹åº”ä½œç”¨åŸŸå’Œå­å…ƒç´ éƒ½å·²å­˜åœ¨ï¼Œå°±å¯¹å®ƒä»¬è¿›è¡Œæ¸…ç†ã€‚
                  	// å¦‚æœè¡¨è¾¾å¼çš„å€¼è§£æä¸ºtrue,å°±åˆ›å»ºä¸€ä¸ªæ–°çš„å­ä½œç”¨åŸŸï¼Œç„¶åä½¿ç”¨åµŒå…¥å‡½æ•°(æ–°åˆ›å»ºçš„ä½œç”¨åŸŸä½œä¸ºå‚æ•°)ï¼Œå…‹éš†ä¸€ä¸ªåµŒå…¥å…ƒç´ çš„æ–°å‰¯æœ¬ï¼Œæœ€åå°†å…‹éš†å…ƒç´ æ’å…¥åˆ°æŒ‡ä»¤å…ƒç´ åé¢
                    scope.$watch(attr['if'], function (newValue) {
                        if (childEle) {
                            childEle.remove();
                            childScope.$destroy();
                            childEle = undefined;
                            childScope = undefined;
                        }
                        if (newValue) {
                            childScope = scope.$new();
                            childEle = transclude(childScope, function (clone) {
                                ele.after(clone);
                            })
                        }
                    })
                }
            }
        }
    }
```

#### åœ¨æŒ‡ä»¤ä¸­ä½¿ç”¨priorityå±æ€§

> æ‰€æœ‰æŒ‡ä»¤éƒ½æœ‰ä¼˜å…ˆçº§ï¼Œé»˜è®¤å€¼ä¸º0ã€‚
>
> åœ¨æ¯ä¸ªå…ƒç´ ä¸Šï¼ŒAngular JSä¼šå…ˆæŒ‰ç…§ä¼˜å…ˆçº§ä»é«˜åˆ°åº•ä¸€æ¬¡ç¼–è¯‘æŒ‡ä»¤ã€‚å¯ä»¥åœ¨æŒ‡ä»¤å¯¹è±¡ä¸Šä½¿ç”¨priorityå±æ€§æ¥è®¾ç½®ä¼˜å…ˆçº§ã€‚
>
> å¦‚æœä¸€ä¸ªæŒ‡ä»¤è®¾å®šä¸ºtranscluydeï¼š 'element'ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨åªä¼šåµŒå…¥é‚£ä¹ˆæŒ‡ä»¤ä¼˜å…ˆçº§æ¯”å½“å‰æŒ‡ä»¤ä¼˜å…ˆçº§ä½çš„å±æ€§ï¼Œå³åªä¼šåµŒå…¥å°šæœªè¢«å¤„ç†è¿‡çš„æŒ‡ä»¤ã€‚

## 9.3 ç†è§£æŒ‡ä»¤æ§åˆ¶å™¨

> Angular JSä¸­çš„æ§åˆ¶å™¨æ˜¯ä¸€ä¸ªé™„å±äºDOMå…ƒç´ çš„å¯¹è±¡ï¼Œä¸»è¦ç”¨äºåˆå§‹åŒ–å·¥ä½œåŠä¸ºå…ƒç´ ä½œä¸ºåœ¨çš„ä½œç”¨åŸŸæ·»åŠ è¡Œä¸ºã€‚

> æŒ‡ä»¤æ§åˆ¶å™¨æ˜¯æ§åˆ¶å™¨çš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œå®ƒç”±æŸä¸ªæŒ‡ä»¤å®šä¹‰è€Œæ¥ï¼Œæ¯å½“æŒ‡ä»¤åœ¨DOMä¸­å‡ºç°æ—¶ï¼Œè¯¥æ§åˆ¶å™¨å°±ä¼šå®ä¾‹åŒ–ä¸€æ¬¡ã€‚æŒ‡ä»¤æ§åˆ¶å™¨çš„èŒè´£æ—¶è´Ÿè´£åˆå§‹åŒ–å·¥ä½œå¹¶ä¸ºæŒ‡ä»¤æä¾›äº¤äº’è¡Œä¸ºã€‚

> å¯ä»¥ä½¿ç”¨æŒ‡ä»¤å®šä¹‰å¯¹è±¡ä¸­çš„controllerå¯¹è±¡æ¥å®šä¹‰ä¸€ä¸ªæŒ‡ä»¤æ§åˆ¶å™¨ã€‚controllerå±æ€§çš„å€¼å¯ä»¥æ—¶ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²æ˜¯
>
> å·²ç»åœ¨æ¨¡å—ä¸Šå®šä¹‰å¥½çš„æ§åˆ¶å™¨åç§°ã€‚
>
> ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç”¨æ¥å®ä¾‹åŒ–æ§åˆ¶å™¨çš„æ„é€ å‡½æ•°ã€‚

### ä¸ºæŒ‡ä»¤æ§åˆ¶å™¨æ³¨å…¥ç‰¹æ®Šä¾èµ–

> Angular Jsä¸ºæŒ‡ä»¤æ§åˆ¶å™¨æ³¨å…¥äº†ä¾èµ–å…³ç³»ã€‚æ‰€æœ‰æ§åˆ¶å™¨éƒ½è¢«æ³¨å…¥äº†$scopeï¼Œè¿˜å¯ä»¥å®šä¹‰å…¶å®ƒéœ€è¦è¢«æ³¨å…¥çš„æœåŠ¡ï¼Œå¦‚$timeoutæˆ–$rootScopeã€‚
>
> è¿˜å¯ä»¥æ³¨å…¥å¦‚ä¸‹ä¸‰ç§ç‰¹æ®ŠæœåŠ¡
>
> - $elementï¼šå¯¹æŒ‡ä»¤DOMå…ƒç´ çš„å¼•ç”¨
> - $attrsï¼šå‡ºç°åœ¨æŒ‡ä»¤DOMå…ƒç´ ä¸Šçš„å±æ€§åˆ—è¡¨
> - $transcludeï¼šç»‘å®šåœ¨å½“å‰ä½œç”¨åŸŸä¸Šçš„åµŒå…¥å‡½æ•°

#### åˆ›å»ºä¸€ä¸ªåŸºäºæ§åˆ¶å™¨çš„åˆ†é¡µæŒ‡ä»¤

> æŒ‡ä»¤æ§åˆ¶å™¨å’Œé“¾æ¥å‡½æ•°åœ¨åŠŸèƒ½ä¸Šæœ‰å¾ˆå¤§é‡å ã€‚ç»å¸¸ä½¿ç”¨æ§åˆ¶å™¨æ¥æ›¿ä»£é“¾æ¥å‡½æ•°ã€‚

è¿™å°±å¯¹äº†ï¼ï¼ï¼ï¼

### ç†è§£æŒ‡ä»¤æ§åˆ¶å™¨å’Œé“¾æ¥å‡½æ•°çš„åŒºåˆ«

#### æ³¨å…¥ä¾èµ–

> æŒ‡ä»¤æ§åˆ¶å™¨å¿…é¡»ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥æŒ‡å®šå®ƒæ‰€éœ€è¦çš„æœåŠ¡ï¼Œå¦‚$scope/$element/$attrsã€‚
>
> é“¾æ¥å‡½æ•°åˆ™æ°¸è¿œè¢«ä¼ å…¥4ä¸ªç›¸åŒçš„å‚æ•°ï¼šscope/element/attrs/controllerï¼Œå®šä¹‰é“¾æ¥å‡½æ•°æ—¶æ‰€ç”¨çš„å‚æ•°åç§°å¯¹æ­¤æ¯«æ— å½±å“ã€‚

#### ç¼–è¯‘è¿‡ç¨‹

> æŒ‡ä»¤æ§åˆ¶å™¨å’Œé“¾æ¥å‡½æ•°æ˜¯åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸åŒæ—¶é—´è¢«è°ƒç”¨çš„ã€‚
>
> å½“ä¸€ä¸ªæŒ‡ä»¤æ§åˆ¶å™¨å®ä¾‹åŒ–æ—¶ï¼Œè¯¥æŒ‡ä»¤çš„æŒ‡ä»¤å…ƒç´ å’Œå­å…ƒç´ éƒ½å°šæœªè¢«å®Œå…¨é“¾æ¥ã€‚
>
> ä½†å½“é“¾æ¥å‡½æ•°ï¼ˆpreæˆ–postï¼‰è¢«è°ƒç”¨æ—¶ï¼Œè¯¥å…ƒç´ çš„æ‰€æœ‰æŒ‡ä»¤æ§åˆ¶å™¨å‡å·²å®ä¾‹åŒ–å®Œæˆã€‚

ä¼¼ä¹æ˜¯è¯´æ§åˆ¶å™¨å®ä¾‹åŒ–æ—©äºé“¾æ¥å‡½æ•°ã€‚

#### è·å–å…¶å®ƒæ§åˆ¶å™¨

> æŒ‡ä»¤æ§åˆ¶å™¨æœ¬èº«æ— æ³•è·å–è¢«æ³¨å…¥æ³¨å…¥å½“å‰æŒ‡ä»¤ä¸­çš„å…¶å®ƒæŒ‡ä»¤æ§åˆ¶å™¨ã€‚

#### è·å–åµŒå…¥å‡½æ•°

> æŒ‡ä»¤æ§åˆ¶å™¨å¯ä»¥è¢«æ³¨å…¥ä¸€ä¸ª$transcludeå‡½æ•°ï¼Œè¯¥åµŒå…¥å‡½æ•°å·²ç»ç»‘å®šäº†æ­£ç¡®çš„ä½œç”¨åŸŸã€‚
>
> é“¾æ¥å‡½æ•°åªèƒ½é€šè¿‡ç¼–è¯‘å‡½æ•°çš„é—­åŒ…æ¥è®¿é—®åµŒå…¥å‡½æ•°ï¼Œè€Œè¯¥åµŒå…¥å‡½æ•°å°šæœªç»‘å®šä½œç”¨åŸŸã€‚

### åˆ›å»ºä¸€ä¸ªæ‰‹é£ç´æŒ‡ä»¤å¥—ä»¶

> æŒ‡ä»¤æ§åˆ¶å™¨ä¸ºæŒ‡ä»¤å…ƒç´ è¿½åŠ è¡Œä¸ºï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥è¢«å…¶å®ƒæŒ‡ä»¤å¼•ç”¨ï¼ˆåœ¨é“¾æ¥å‡½æ•°ä¸­é€šè¿‡å‚æ•°å¼•ç”¨ï¼‰ã€‚



å¤–éƒ¨å®¹å™¨accordion

> æ¯ä¸€ä¸ªaccordion-groupæŒ‡ä»¤éƒ½éœ€è¦å¼•å…¥è¿™ä¸ªæ§åˆ¶å™¨ã€‚

```javascript
 angular.module('comAccordion', []);

    angular.module('comAccordion')
        .directive('accordion',  config);

    function config() {
        return {
            restrict: 'E',
            controller: accordionCtrl,
            link: function (scope, ele) {
                ele.addClass('accordion');
            }
        }
    }

    function accordionCtrl() {
        var vm = this;
        vm.groups = [];
        vm.closeOthers = function (openGroup) {
            angular.forEach(vm.groups, function (group) {
                if (group !== openGroup) {
                    group.isOpen = false;
                }
            });
        };
        vm.addGroup = function (groupScope) {
            vm.groups.push(groupScope);
            groupScope.$on('$destroy', function (event) {
                this.removeGroup(groupScope);
            });
        };
        vm.removeGroup = function (group) {
            var index = vm.groups.indexOf(group);
            if(index !== -1) {
                vm.groups.splice(index, 1)
            }
        }
    }
```

å†…éƒ¨å…·ä½“å†…å®¹accordion-group 

```html
<div class="accordion-group">
    <div class="accordion-heading">
        <a class="accordion-toggle" ng-click="isOpen = !isOpen">{{heading}}</a>
    </div>
    <div class="accordion-body" ng-show="isOpen">
        <div class="accordion-inner" ng-transclude="">

        </div>
    </div>
</div>
```

```javascript
 angular.module('comAccordionGroup', []);

    angular.module('comAccordionGroup')
        .directive('accordionGroup', config);

    function config() {
        return {
            restrict: 'E',
            require: '^accordion',
            transclude: true,
            replace: true,
            templateUrl: './src/components/accordionGroup/accGroup.tpl.html',
            scope: {
                heading: '@'
            },
            link: function (scope, ele, attrs, accordionCtrl) {
                accordionCtrl.addGroup(scope);
                scope.isOpen = false;
                scope.$watch('isOpen', function (value) {
                    if (value) {
                        accordionCtrl.closeOthers(scope);
                    }
                })
            }
        }
    }
```

> accordion-groupæŒ‡ä»¤éœ€è¦accordionæŒ‡ä»¤çš„æŒ‡ä»¤æ§åˆ¶å™¨ï¼Œaccordionåœ¨DOMç»“æ„ä¸Šæ—¶accordion-groupæŒ‡ä»¤çš„ç¥–å…ˆã€‚accordionçš„æŒ‡ä»¤æ§åˆ¶å™¨ä½œä¸ºç¬¬4ä¸ªå‚æ•°ï¼Œå‘½åä¸ºaccordionCtrl ï¼Œä¼ é€’ç»™äº†é“¾æ¥å‡½æ•°ã€‚accordion-groupæŒ‡ä»¤ä½¿ç”¨accordionCtrlçš„addGroup()å‡½æ•°å°†è‡ªå·±æ³¨å†Œåœ¨æ‰‹é£ç´ä¸Šï¼Œç„¶ååœ¨è‡ªå·±å±•å¼€æ—¶è°ƒç”¨closeOthers()æ¥å¤„ç†å…¶å®ƒåŒºå—ã€‚

## æ§åˆ¶ç¼–è¯‘è¿‡ç¨‹

> æœ‰äº›æƒ…å†µä¸‹ï¼Œéœ€è¦å¯¹Angular JSçš„ç¼–è¯‘è¿‡ç¨‹ä¸å¦‚ä½•è¿æ¥å…ƒç´ åŠå…¶å­å…ƒç´ ğŸˆ¶ï¸æ›´å¤šçš„æ§åˆ¶ã€‚ä¹Ÿè®¸æ˜¯æƒ³åŠ¨æ€åœ°åŠ è½½æŒ‡ä»¤æ¨¡ç‰ˆï¼Œæˆ–è€…æƒ³å¯¹å…ƒç´ åµŒå…¥æŒ‡ä»¤æ¨¡ç‰ˆğŸˆ¶ï¸æ›´å¤šçš„æ§åˆ¶ã€‚è¿™äº›æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ç»ˆæ­¢ç¼–è¯‘è¿‡ç¨‹ï¼Œç„¶åè¿›è¡Œè‡ªå®šä¹‰ä¿®æ”¹ï¼Œä¹‹åæ‰‹åŠ¨ç¼–è¯‘æŒ‡ä»¤çš„å…ƒç´ åŠå…¶å­å…ƒç´ ã€‚

### åˆ›å»ºä¸€ä¸ªfieldæŒ‡ä»¤



